<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Admin CMS</title>

<style>
body{font-family:sans-serif;padding:30px}
input,textarea{width:100%;margin:5px 0;padding:6px}
.card{border:1px solid #ddd;padding:10px;margin:10px 0}
.drop{border:2px dashed #aaa;padding:30px;text-align:center}
.stats{display:flex;gap:20px}
button{margin:4px}
</style>
</head>

<body>

<div id="login">
<h2>Login</h2>
<input type="password" id="pass">
<button onclick="login()">Login</button>
</div>

<div id="panel" style="display:none">

<h2>Dashboard</h2>
<div class="stats">
<div>Total: <b id="s1"></b></div>
<div>Likes: <b id="s2"></b></div>
<div>Top: <b id="s3"></b></div>
</div>

<h3>Add / Edit</h3>

<div class="drop" id="drop">Drag image here</div>

<input id="link" placeholder="Link or uploaded">
<input id="title" placeholder="Title">
<textarea id="desc"></textarea>
<input id="tags" placeholder="tags">

<button onclick="save()">Save</button>

<hr>
<div id="list"></div>

</div>

<script>
const API="PASTE_EXEC_URL_HERE";
let PASSWORD="";
let editId=null;

function login(){
  PASSWORD=pass.value;
  login.style.display="none";
  panel.style.display="block";
  load();
  stats();
}

drop.ondragover=e=>e.preventDefault();
drop.ondrop=e=>{
  e.preventDefault();
  const f=e.dataTransfer.files[0];
  const r=new FileReader();
  r.onload=()=>link.value=r.result;
  r.readAsDataURL(f);
};

async function stats(){
  const r=await fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"stats",password:PASSWORD})
  });
  const d=await r.json();
  s1.innerText=d.total;
  s2.innerText=d.likes;
  s3.innerText=d.top;
}

async function load(){
  const r=await fetch(API);
  const data=await r.json();
  list.innerHTML="";

  data.forEach(item=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      ${item.title}
      <button onclick='edit(${JSON.stringify(item)})'>Edit</button>
      <button onclick='del(${item.id})'>Delete</button>
    `;
    list.appendChild(d);
  });
}

function edit(item){
  editId=item.id;
  link.value=item.link;
  title.value=item.title;
  desc.value=item.description;
  tags.value=item.tags;
}

function save(){
  const action=editId?"edit":"add";

  fetch(API,{
    method:"POST",
    body:JSON.stringify({
      action,
      id:editId,
      password:PASSWORD,
      link:link.value,
      title:title.value,
      description:desc.value,
      tags:tags.value
    })
  });

  editId=null;
  setTimeout(()=>{load();stats();},800);
}

function del(id){
  fetch(API,{
    method:"POST",
    body:JSON.stringify({action:"delete",id,password:PASSWORD})
  });
  setTimeout(()=>{load();stats();},800);
}
</script>
</body>
</html>
