<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>huh yunjin is loved ₊˚ෆ⊹₊ ⋆</title>

<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>

<style>
body{font-family:sans-serif;margin:0}
header{text-align:center;padding:20px;font-size:28px}
.grid{margin:auto;max-width:1200px}
.grid-item{width:240px;margin-bottom:15px;border-radius:12px;overflow:hidden;cursor:pointer}
.grid-item img{width:100%}
.controls{text-align:center;margin:15px}
button{padding:6px 12px;margin:5px}
.tag{background:#eee;padding:3px 8px;margin:2px;border-radius:10px;cursor:pointer}
</style>
</head>

<body>

<header>huh yunjin is loved ₊˚ෆ⊹₊ ⋆</header>

<div class="controls">
<input id="search" placeholder="search">
<button onclick="prev()">Prev</button>
<button onclick="next()">Next</button>
<div id="tags"></div>
</div>

<div class="grid" id="grid"></div>

<script>
const API="https://script.google.com/macros/s/AKfycbwOSjiZoFntn7fQqMDkM-fQntp_fsQX_xBdiuOOkB97nk6vZdl8kDTd5EQV4AMeWCi4Ow/exec";

let data=[],page=0,per=12,filtered=[];

async function load(){
  const r=await fetch(API);
  data=await r.json();
  filtered=data;
  renderTags();
  render();
}

function render(){
  const grid=document.getElementById("grid");
  grid.innerHTML="";

  const slice=filtered.slice(page*per,(page+1)*per);

  slice.forEach(item=>{
    const d=document.createElement("div");
    d.className="grid-item";
    d.innerHTML=`<img src="${item.imageUrl}">`;
    d.onclick=()=>like(item.id);
    grid.appendChild(d);
  });

  new Masonry(grid,{itemSelector:'.grid-item',columnWidth:240,gutter:10});
}

function like(id){
 fetch(API,{method:'POST',mode:'no-cors',
 body:JSON.stringify({action:'like',id})});
}

function next(){page++;render()}
function prev(){if(page>0)page--;render()}

search.oninput=()=>{
  const q=search.value.toLowerCase();
  filtered=data.filter(x=>x.title.toLowerCase().includes(q));
  page=0;render();
}

function renderTags(){
  const box=document.getElementById("tags");
  const all=[...new Set(data.flatMap(x=>x.tags.split(",")))];

  box.innerHTML="";
  all.forEach(t=>{
    if(!t) return;
    const s=document.createElement("span");
    s.className="tag";
    s.innerText=t;
    s.onclick=()=>{
      filtered=data.filter(x=>x.tags.includes(t));
      page=0;render();
    };
    box.appendChild(s);
  });
}

setInterval(load,10000);
load();
</script>

</body>
</html>
